<!DOCTYPE html>
<html>
<head>
    <title>Ping Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, text-align: center; padding: 20px; }
        button { 
            background: #0088cc; 
            color: white; 
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
        #status { margin: 20px 0; font-weight: bold; }
    </style>
</head>
<body>
    <h2>üì∂ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏–Ω–≥–∞</h2>
    <button onclick="measurePing()">‚ñ∂ –ò–∑–º–µ—Ä–∏—Ç—å</button>
    <div id="status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        const tg = Telegram.WebApp;
        tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.ready(); // –ì–æ–≤–æ—Ä–∏–º Telegram, —á—Ç–æ Mini App –≥–æ—Ç–æ–≤

        function measurePing() {
            const statusEl = document.getElementById("status");
            
            // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ—Ä–µ–Ω–∏—è
            statusEl.innerHTML = "‚è≥ –ò–∑–º–µ—Ä—è–µ–º –ø–∏–Ω–≥...";
            
            // 2. –ò–º–∏—Ç–∞—Ü–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∑–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å fetch)
            setTimeout(() => {
                const ping = Math.floor(Math.random() * 100);
                statusEl.innerHTML = `üèì –ü–∏–Ω–≥: <b>${ping} –º—Å</b>`;
                
                // 3. –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const data = {
                    action: "ping_test",
                    ping: ping,
                    time: new Date().toISOString()
                };
                
                // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
                try {
                    tg.sendData(JSON.stringify(data));
                    console.log("–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã:", data);
                    
                    // 5. –ó–∞–∫—Ä—ã–≤–∞–µ–º Mini App —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => tg.close(), 2000);
                } catch (e) {
                    statusEl.innerHTML += "<br><br>‚ùå <i>–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</i>";
                    console.error("–û—à–∏–±–∫–∞:", e);
                }
            }, 1500);
        }
        
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        console.log("InitData:", tg.initData);
        console.log("Platform:", tg.platform);
    </script>
</body>
</html>
